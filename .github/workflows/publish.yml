name: Publish to crates

on:
    workflow_run:
        workflows: ["Release"]
        branches:
          - 'main'
        types: ["completed"]

jobs:
    publish-crate:
        runs-on: ubuntu-latest
        environment: production
        strategy:
            matrix:
                package: [youtube-transcript]
        steps:
            - name: Checkout
              uses: actions/checkout@v3
            - name: Rust tooling
              uses: dtolnay/rust-toolchain@stable
            - name: Cache rust
              uses: Swatinem/rust-cache@v2
            - name: publish
              run: cargo publish -p ${{ matrix.package }}